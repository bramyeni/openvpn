# $Id: Dockerfile 390 2021-05-31 16:56:54Z bpahlawa $
# $Author: bpahlawa $
# Created: 26-APR-2021
# Modified by: bpahlawa
# $Date: 2021-06-01 00:56:54 +0800 (Tue, 01 Jun 2021) $
# $Revision: 390 $
#
# How to run the docker image
# for single node:    
# docker run -it --name openvpn --net host -v /opt/openvpn:/etc/openvpn --cap-add=NET_ADMIN --device /dev/net/tun:/dev/net/tun openvpn server archdocker
# 
# add entrypoint.sh in base64 to Dockerfile
# echo -e "RUN echo \"$(cat openvpn.env | base64 -w0)\" | base64 -d > /usr/local/bin/openvpn.env\nRUN chmod ugo+x /usr/local/bin/openvpn.env" >> Dockerfile
# echo -e "RUN echo \"$(cat entrypoint-openvpn.sh | base64 -w0)\" | base64 -d > /usr/local/bin/entrypoint-openvpn.sh\nRUN chmod ugo+x /usr/local/bin/entrypoint-openvpn.sh\nENTRYPOINT [\"/usr/local/bin/entrypoint-openvpn.sh\"]" >> Dockerfile
#
# How to build this Dockerfile
# Run the following command where Dockerfile exists
#
# docker build --tag openvpn .

FROM alpine:latest
MAINTAINER brpahlaw

WORKDIR /usr/local/bin
RUN apk update
RUN apk upgrade
RUN apk add openvpn easy-rsa openssh-client
RUN echo "IyEvYmluL2Jhc2gKIyAkSWQ6IGdhbGVyYS5lbnYgMzc4IDIwMjEtMDQtMjYgMDk6Mzc6NDJaIGJwYWhsYXdhICQKIyBDcmVhdGVkIDE5LUFQUi0yMDIxCiMgJEF1dGhvcjogYnBhaGxhd2EgJAojICREYXRlOiAyMDIxLTA0LTI2IDE3OjM3OjQyICswODAwIChNb24sIDI2IEFwciAyMDIxKSAkCiMgJFJldmlzaW9uOiAzNzggJAoKCmV4cG9ydCBPUEVOVlBOX1BPUlQ9JHtPUEVOVlBOX1BPUlQ6LTExOTR9CmV4cG9ydCBPUEVOVlBOX1BST1RPQ09MPSR7T1BFTlZQTl9QUk9UT0NPTDotInVkcCJ9CmV4cG9ydCBPUEVOVlBOX1VTRVI9JHtPUEVOVlBOX1VTRVI6LSJub2JvZHkifQpleHBvcnQgT1BFTlZQTl9HUk9VUD0ke09QRU5WUE5fR1JPVVA6LSJub2JvZHkifQpleHBvcnQgT1BFTlZQTl9DSVBIRVI9JHtPUEVOVlBOX0NJUEhFUjotIkFFUy0yNTYtR0NNIn0KZXhwb3J0IE9QRU5WUE5fVExTVkVSX01JTj0ke09QRU5WUE5fVExTVkVSX01JTjotIjEuMiJ9CmV4cG9ydCBPUEVOVlBOX1RMU19DSVBIRVI9JHtPUEVOVlBOX1RMU19DSVBIRVI6LSJUTFMtRUNESEUtRUNEU0EtV0lUSC1BRVMtMjU2LUdDTS1TSEEzODQifQpleHBvcnQgT1BFTlZQTl9NQVhfQ0xJRU5UUz0ke09QRU5WUE5fTUFYX0NMSUVOVFM6LSI1In0KZXhwb3J0IE9QRU5WUE5fU1RBVFVTX0xPRz0ke09QRU5WUE5fU1RBVFVTX0xPRzotIi92YXIvbG9nL29wZW52cG4tc3RhdHVzLmxvZyJ9CmV4cG9ydCBPUEVOVlBOX1NUQVRVU19WRVJCT1NJVFk9JHtPUEVOVlBOX1NUQVRVU19WRVJCT1NJVFk6LSI1In0KZXhwb3J0IE9QRU5WUE5fREVWPSR7T1BFTlZQTl9ERVY6LSJ0dW4ifQpleHBvcnQgT1BFTlZQTl9ST1VURV9DTUQ9JHtPUEVOVlBOX1JPVVRFX0NNRDotInJvdXRlIDE5Mi4xNjguMC4wIDI1NS4yNTUuMjU1LjAifQpleHBvcnQgT1BFTlZQTl9QVVNIX0NNRD0ke09QRU5WUE5fUFVTSF9DTUQ6LSJwdXNoIFwicm91dGUgMTAuMi4wLjAgMjU1LjI1NS4yNTUuMFwiIn0KZXhwb3J0IE9QRU5WUE5fUkVCVUlMRF9DQUNFUlQ9JHtPUEVOVlBOX1JFQlVJTERfQ0FDRVJUOi0ibm8ifQpleHBvcnQgT1BFTlZQTl9SRUJVSUxEX0NFUlQ9JHtPUEVOVlBOX1JFQlVJTERfQ0VSVDotInllcyJ9CmV4cG9ydCBPUEVOVlBOX0hPU1RfRElTSz0ke09QRU5WUE5fSE9TVF9ESVNLOi0iL29wdC9vcGVudnBuIn0KCgojU2VydmVyIHNwZWNpZmljCmV4cG9ydCBPUEVOVlBOX1NFUlZFUl9DTUQ9JHtPUEVOVlBOX1NFUlZFUl9DTUQ6LSJzZXJ2ZXIgMTAuOC4wLjAgMjU1LjI1NS4yNTUuMCJ9CiNtdWx0aXBsZSByb3V0ZSBieSB1c2luZyBjb2xvbiA6CmV4cG9ydCBPUEVOVlBOX0NMSUVOVENPTkZJR19ESVI9JHtPUEVOVlBOX0NMSUVOVENPTkZJR19ESVI6LSIvZXRjL29wZW52cG4vY2xpZW50LWNvbmZpZ3MifQpleHBvcnQgT1BFTlZQTl9DTElFTlRDT05GSUdfQ01EPSR7T1BFTlZQTl9DTElFTlRDT05GSUdfQ01EOi0iaWZjb25maWctcHVzaCAxMC44LjAuMiAxMC44LjAuMVxuaXJvdXRlIDE5Mi4xNjguMC4wIDI1NS4yNTUuMjU1LjAifQoKI3NlbGYtc2lnbmVkIGNlcnRpZmljYXRlIHNwZWNpZmljCmV4cG9ydCBPUEVOVlBOX0VBU1lSU0FfU1NMX0NPTkY9JHtPUEVOVlBOX0VBU1lSU0FfU1NMX0NPTkY6LSIvZXRjL29wZW52cG4vZWFzeS1yc2Evb3BlbnNzbC1lYXN5cnNhLmNuZiJ9CmV4cG9ydCBPUEVOVlBOX0VBU1lSU0FfUkVRX0NPVU5UUlk9JHtPUEVOVlBOX0VBU1lSU0FfUkVRX0NPVU5UUlk6LSJBVSJ9CmV4cG9ydCBPUEVOVlBOX0VBU1lSU0FfUkVRX1BST1ZJTkNFPSR7T1BFTlZQTl9FQVNZUlNBX1JFUV9QUk9WSU5DRTotIldlc3Rlcm4gQXVzdHJhbGlhIn0KZXhwb3J0IE9QRU5WUE5fRUFTWVJTQV9SRVFfQ0lUWT0ke09QRU5WUE5fRUFTWVJTQV9SRVFfQ0lUWTotIlBlcnRoIn0KZXhwb3J0IE9QRU5WUE5fRUFTWVJTQV9SRVFfT1JHPSR7T1BFTlZQTl9FQVNZUlNBX1JFUV9PUkc6LSJCcmFtIEVudGVycHJpc2UifQpleHBvcnQgT1BFTlZQTl9FQVNZUlNBX1JFUV9FTUFJTD0ke09QRU5WUE5fRUFTWVJTQV9SRVFfRU1BSUw6LSJzYWxlc0BicmFtLmNvbSJ9CmV4cG9ydCBPUEVOVlBOX0VBU1lSU0FfUkVRX09VPSR7T1BFTlZQTl9FQVNZUlNBX1JFUV9PVTotIklUIn0KZXhwb3J0IE9QRU5WUE5fRUFTWVJTQV9LRVlfU0laRT0ke09QRU5WUE5fRUFTWVJTQV9LRVlfU0laRTotIjIwNDgifQpleHBvcnQgT1BFTlZQTl9DQV9QQVNTV09SRD0ke09QRU5WUE5fQ0FfUEFTU1dPUkQ6LSJHMGRrbjB3cyJ9CmV4cG9ydCBPUEVOVlBOX0VBU1lSU0FfQkFUQ0g9JHtPUEVOVlBOX0VBU1lSU0FfQkFUQ0g6LSJ5ZXMifQpleHBvcnQgT1BFTlZQTl9FQVNZUlNBX1JFUV9DTj0ke09QRU5WUE5fRUFTWVJTQV9SRVFfQ046LSJ0aGVob3N0In0K" | base64 -d > /usr/local/bin/openvpn.env
RUN chmod ugo+x /usr/local/bin/openvpn.env
RUN echo "IyEvYmluL3NoCiMgJElkOiBlbnRyeXBvaW50LnNoIDM3OSAyMDIxLTA0LTI2IDEyOjI3OjAwWiBicGFobGF3YSAkCiMgQ3JlYXRlZCAxOS1BUFItMjAyMQojICRBdXRob3I6IGJwYWhsYXdhICQKIyAkRGF0ZTogMjAyMS0wNC0yNiAyMDoyNzowMCArMDgwMCAoTW9uLCAyNiBBcHIgMjAyMSkgJAojICRSZXZpc2lvbjogMzc5ICQKCgojIFVzZXIgc3BlY2lmaWMgZW52aXJvbm1lbnQgYW5kIHN0YXJ0dXAgcHJvZ3JhbXMKUkVERk9OVD0iXGVbMzg7NTsxOTdtIgpHUkVFTkZPTlQ9IlxlWzM4OzU7ODJtIgpOT1JNQUxGT05UPSJcZVswbSIKQkxVRUZPTlQ9IlxlWzM4OzU7MTIzbSIKWUVMTE9XRk9OVD0iXGVbMzg7NTsyMjltIgpWRVJTSU9OX0lEPSIiCkFMTFZFUj0iIgpleHBvcnQgRElTVFJPPSIiClBLR0RJU1RSTz0iIgpSVU5QS0dVUERBVEU9IjEiCkxPR0ZJTEU9L3RtcC8kKGJhc2VuYW1lICQwIHwgY3V0IC1mMSAtZC4pLmxvZwpPVlVTRVI9Im9wZW52cG4iCmV4cG9ydCBPVlBOUEVSU0lTVERJUj0vZXRjL29wZW52cG4KZXhwb3J0IEVBU1lSU0FESVI9IiRPVlBOUEVSU0lTVERJUi9lYXN5LXJzYSIKRUFTWVJTQT0iIgpJUEFERFI9IiIKCk9QRU5WUE5NT0RFPSQoZWNobyAiJDEiIHwgdHIgWzpsb3dlcjpdIFs6dXBwZXI6XSkKb3BlbnZwbm1vZGU9JChlY2hvICIkMSIgfCB0ciBbOnVwcGVyOl0gWzpsb3dlcjpdKQoKRlFETkNMSUVOVE9SU0VSVkVSPSIkMiIKCkNMSUVOVE9SU0VSVkVSPSIkKGVjaG8gJEZRRE5DTElFTlRPUlNFUlZFUiB8IGN1dCAtZjEgLWQuKSIKCgpjcmVhdGVfdHJ1c3RlZF9sb2dpbigpCnsKICAgZGlzcGxheV9vdXRwdXQgIlxuJHtZRUxMT1dGT05UfVlvdSBtdXN0IGJlIGFibGUgdG8gbG9naW4gYXMgcm9vdCBpbnRvICRGUUROQ0xJRU5UT1JTRVJWRVIgaG9zdC4uXG5pZiBub3QgdGhlbiBwbGVhc2Ugc2V0dXAgcm9vdCBwYXNzd29yZCBhdCAkQ0xJRU5UT1JTRVJWRVIgYW5kIHJvb3QgbXVzdCBiZSBhYmxlIHRvIGxvZ2luIHRvIHRoaXMgaG9zdCB0aHJvdWdoIHNzaCEhXG4iCiAgIGlmIFsgISAtZCB+Ly5zc2ggXQogICB0aGVuCiAgICAgICBzc2gta2V5Z2VuIC1QICIiIC1mIH4vLnNzaC9pZF9yc2EKICAgZWxzZQogICAgICAgW1sgISAtZiB+Ly5zc2gvaWRfcnNhLnB1YiBdXSAmJiBzc2gta2V5Z2VuIC1QICIiIC1mIH4vLnNzaC9pZF9yc2EKICAgZmkKICAgUk9PVF9QVUJMSUNLRVk9IiQoY2F0IH4vLnNzaC9pZF9yc2EucHViKSIKICAgc3NoICRGUUROQ0xJRU5UT1JTRVJWRVIgIgogICAgICAgW1sgISAtZCB+Ly5zc2ggXV0gJiYgbWtkaXIgLXAgfi8uc3NoCiAgICAgICBpZiBbICEgLWYgfi8uc3NoL2F1dGhvcml6ZWRfa2V5cyBdCiAgICAgICB0aGVuCiAgICAgICAgICBlY2hvICR7Uk9PVF9QVUJMSUNLRVl9ID4+IH4vLnNzaC9hdXRob3JpemVkX2tleXMKICAgICAgIGVsc2UKICAgICAgICAgIFtbIFxgZ3JlcCBcIiRST09UX1BVQkxJQ0tFWVwiIH4vLnNzaC9hdXRob3JpemVkX2tleXMgfCB3YyAtbFxgIC1lcSAwIF1dICYmIGVjaG8gJHtST09UX1BVQkxJQ0tFWX0gPj4gfi8uc3NoL2F1dGhvcml6ZWRfa2V5cwogICAgICAgZmkKIgogICBzc2ggJEZRRE5DTElFTlRPUlNFUlZFUiAiZWNobyIgMT4mMiA+L2Rldi9udWxsCiAgIFtbICQ/IC1uZSAwIF1dICYmIGRpc3BsYXlfb3V0cHV0ICIke1JFREZPTlR9VW5hYmxlIHRvIGNvbm5jdCB0byAkRlFETkNMSUVOVE9SU0VSVkVSIGhvc3QuLi4gcGxlYXNlIGNoZWNrIHRoZSBuYW1lLi4uIiAmJiBleGl0IDEKCn0KCgp1c2FnZSgpCnsKICAgZGlzcGxheV9vdXRwdXQgIiR7WUVMTE9XRk9OVH1cblVzYWdlOiAkMCBvcGVudnBuLW1vZGUgcGFpcmVkLWhvc3RuYW1lIgogICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9XG5vcGVudnBuLW1vZGUgPT4gc2VydmVyICwgcGFpcmVkLWhvc3RuYW1lID0+IGNsaWVudC1ob3N0bmFtZVxub3BlbnZwbi1tb2RlID0+IGNsaWVudCAsIHBhaXJlZC1ob3N0bmFtZSA9PiBzZXJ2ZXItaG9zdG5hbWUiCiAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfVxuRS5nOiAkMCBzZXJ2ZXIgbGludXgwMVxuICAgICAkMCBjbGllbnQgdWJ1bnR1c3ZyMDEiIAp9CgoKbWFzcXVlcmFkZV9hbGwoKQp7CiAgTkVUSU5UPSQobHMgLWwgL3N5cy9jbGFzcy9uZXQvIHwgZWdyZXAgLXYgInZpcnR1YWx8dG90YWwiIHwgYXdrICd7cHJpbnQgJChORi0yKX0nKQogIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfUV4ZWN1dGluZyBpcHRhYmxlcyBjb21tYW5kIGZvciBpbnRlcmZhY2UgJE5FVElOVC4uLiIKICBpcHRhYmxlcyAtdCBuYXQgLUEgUE9TVFJPVVRJTkcgLW8gJE5FVElOVCAtaiBNQVNRVUVSQURFCiAgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfWlwdGFibGVzIC10IG5hdCAtQSBQT1NUUk9VVElORyAtbyAkTkVUSU5UIC1qIE1BU1FVRVJBREUiCiAgVFVOSU5UPSIke09QRU5WUE5fREVWfTAiCiAgZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9RXhlY3V0aW5nIGlwdGFibGVzIGNvbW1hbmQgZm9yIGludGVyZmFjZSAkVFVOSU5ULi4uIgogIGlwdGFibGVzIC10IG5hdCAtQSBQT1NUUk9VVElORyAtbyAkVFVOSU5UIC1qIE1BU1FVRVJBREUKICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9aXB0YWJsZXMgLXQgbmF0IC1BIFBPU1RST1VUSU5HIC1vICRUVU5JTlQgLWogTUFTUVVFUkFERSIKfQoKCmdldF9pcF9hZGRyKCkKewogICBsb2NhbCBORVRJTlQKICAgZm9yIE5FVElOVCBpbiAkKGxzIC1sIC9zeXMvY2xhc3MvbmV0LyB8IGVncmVwIC12ICJ2aXJ0dWFsfHRvdGFsIiB8IGF3ayAne3ByaW50ICQoTkYtMil9JykKICAgZG8KICAgICAgSVBBRERSPSIkKGlwIC0tYnJpZWYgYWRkciBzaG93IGRldiAkTkVUSU5UIHwgYXdrICd7cHJpbnQgJDN9JyB8IHNlZCAnc3wvLip8fGcnKSIKICAgICAgW1sgSVBBRERSICE9ICIiIF1dICYmIGJyZWFrCiAgIGRvbmUKfQoKcnVubmluZ19vbl9kb2NrZXIoKQp7CiAgIGRpc3BsYXlfb3V0cHV0ICIke1lFTExPV0ZPTlR9UnVubmluZyBvbiBkb2NrZXIgbXVzdCBiZSB1c2luZyBob3N0IG5ldHdvcmsgYW5kIGFsc28gcHJpdmlsZWdlZCBmbGFnLi4uIgogICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9Rm9yIHR1biBkZXZpY2U6XG5kb2NrZXIgcnVuIC1pdCAtLW5hbWUgb3BlbnZwbiAtLWNhcC1hZGQ9TkVUX0FETUlOIC0tZGV2aWNlIC9kZXYvbmV0L3R1biAtaXQgb3BlbnZwbiIKICAgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfUZvciB0YXAgZGV2aWNlOlxuZG9ja2VyIHJ1biAtaXQgLS1uYW1lIG9wZW52cG4gLS1jYXAtYWRkPU5FVF9BRE1JTiAtLWRldmljZSAvZGV2L25ldC90YXAgLWl0IG9wZW52cG4iCn0KCmRpc3BsYXlfb3V0cHV0KCkKewogICBsb2NhbCBNRVNTQUdFPSIkMSIKICAgbG9jYWwgSElERT0iJDIiCgogICBbWyAiJEhJREUiID0gIjEiIHx8ICIkSElERSIgPSAiIiBdXSAmJiBlY2hvIC1lICIkTUVTU0FHRSR7Tk9STUFMRk9OVH0iCiAgIFtbICIkSElERSIgPSAiMiIgfHwgIiRISURFIiA9ICIiIF1dICYmIGVjaG8gLWUgIiRNRVNTQUdFIiB8IHNlZCAtciAicy9bWzpjbnRybDpdXVxbKFswLTldezEsM307KSpbMC05XXsxLDN9bS8vZyIgPj4gJExPR0ZJTEUKfQoKW1sgIiRDTElFTlRPUlNFUlZFUiIgPSAiIiBdXSAmJiB1c2FnZSAmJiBleGl0IDEKCkNPTkZJR0ZJTEU9Ii9ldGMvb3BlbnZwbi9vcGVudnBuLmNvbmYiCgp0cmFwIGV4aXRzaGVsbCBTSUdJTlQgU0lHVEVSTQoKZGF0ZSA+ICRMT0dGSUxFCgpbWyAhIC1mIC4vb3BlbnZwbi5lbnYgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1VbmFibGUgdG8gZmluZCBvcGVudnBuLmVudiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZmlsZS4uIiAmJiBleGl0IDEKc291cmNlIC4vb3BlbnZwbi5lbnYKCmNoZWNraW5nX3JlcWRfdG9vbHMoKQp7CiAgIHdoaWNoIC0tdmVyc2lvbiAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBbWyAkPyAtbmUgMCBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtSRURGT05UfXdoaWNoIGNvbW1hbmQgZG9lc250IGV4aXN0LCBwbGVhc2UgaW5zdGFsbCBpdC4uLiIgJiYgZXhpdAp9CgpleGl0c2hlbGwoKQp7CiAgIGRpc3BsYXlfb3V0cHV0ICIke05PUk1BTEZPTlR9Q2FuY2VsbGluZyBzY3JpcHQuLi4uZXhpdGluZy4uLi4uIgogICBleGl0IDAKfQoKCmlzX29wZW52cG5fcnVubmluZygpIHsKICAgIFBJRD0kKHBzIC1vIHBpZCx1c2VyLGFyZ3MgfCBncmVwICcgb3BlbnZwbiAnIHwgZ3JlcCAtdiBncmVwIHwgYXdrICd7cHJpbnQgJDF9JykKICAgIFtbICIkUElEIiAhPSAiIiBdXSAmJiBraWxsIC0wICIkUElEIiAyPi9kZXYvbnVsbCB8fCByZXR1cm4gMSAKfQoKCgpjaGVja19maWxlc3lzdGVtKCkKewogICBsb2NhbCBNT1VOVFBUPSIkMSIKICAgRlNUWVBFPSQoZGYgJE1PVU5UUFQgfCB0YWlsIC0xIHwgYXdrICd7cHJpbnQgJDF9JykKICAgZWNobyAiJEZTVFlQRSIKfQoKY2hlY2tfbmV0d29ya19ob3N0KCkKewogICBpZiBbWyAiJChpcCAtbyBsaW5rIHwgYXdrICd7cHJpbnQgJDJ9JyB8IGdyZXAgLXYgbG8gfCBncmVwICJcQCIpIiAhPSAiIiBdXQogICB0aGVuCiAgICAgICBydW5uaW5nX29uX2RvY2tlcgogICAgICAgZXhpdCAxCiAgIGVsc2UKICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1PcGVudnBuIGlzIHJ1bm5pbmcgb24gYSBjb250YWluZXIgd2l0aCB0aGUgY29ycmVjdCBwYXJhbWV0ZXJzLi4uIgogICBmaQp9CgoKaW5pdGlhdGVfcGtpX2NhX2RoKCkKewogIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfUluaXRpYXRpbmcgcGtpLi4uIgogICRFQVNZUlNBIGluaXQtcGtpIAogIFtbICQ/IC1lcSAwIF1dICYmIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1pbml0aW5nIHBraSBoYXMgYmVlbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IiB8fCBleGl0IDEKICBsbiAtcyAuLi9vcGVuc3NsLWVhc3lyc2EuY25mIC4vcGtpL3NhZmVzc2wtZWFzeXJzYS5jbmYKICBkaXNwbGF5X291dHB1dCAiJHtCTFVFRk9OVH1DcmVhdGluZyBjYSBjZXJ0aWZpY2F0ZS4uLiIKICAkRUFTWVJTQSBidWlsZC1jYSA8PCEKJHtPUEVOVlBOX0NBX1BBU1NXT1JEfQoke09QRU5WUE5fQ0FfUEFTU1dPUkR9CiQoaG9zdG5hbWUpCiEKICBbWyAkPyAtZXEgMCBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9Y3JlYXRpbmcgY2EgY2VydGlmaWNhdGUgaGFzIGJlZW4gY29tcGxldGVkIHN1Y2Nlc3NmdWxseSIgfHwgZXhpdCAxCgogIFtbICIkT1BFTlZQTk1PREUiID0gIlNFUlZFUiIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9Q3JlYXRpbmcgREggY2VydGlmaWNhdGUuLi4iICYmICRFQVNZUlNBIGdlbi1kaAp9CgoKCmNyZWF0ZV9jZXJ0aWZpY2F0ZSgpCnsKICAgIFtbICEgLWQgL3Vzci9zaGFyZS9lYXN5LXJzYSBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtSRUR9ZWFzeXJzYSBpcyBub3QgaW5zdGFsbGVkISEiCiAgICBbWyAhIC1kICRFQVNZUlNBRElSIF1dICYmIG1rZGlyIC1wICRFQVNZUlNBRElSCiAgICBpZiBbWyAiJE9QRU5WUE5fUkVCVUlMRF9DQUNFUlQiID0gInllcyIgfHwgISAtZCAkRUFTWVJTQURJUi9wa2kgfHwgISAtZiAkRUFTWVJTQURJUi9wa2kvY2EuY3J0IF1dCiAgICB0aGVuCiAgICAgICBybSAtcmYgJEVBU1lSU0FESVIvKgogICAgICAgY3AgLXJwIC91c3Ivc2hhcmUvZWFzeS1yc2EvKiAkRUFTWVJTQURJUgogICAgICAgY2QgJEVBU1lSU0FESVIKICAgICAgIEVBU1lSU0E9JChmaW5kIC4gLW5hbWUgImVhc3lyc2EiKQogICAgICAgVkFSUz0kRUFTWVJTQURJUi92YXJzCiAgICAgICBjcCAtciAkRUFTWVJTQURJUi92YXJzLmV4YW1wbGUgJFZBUlMKICAgICAgIHNlZCAtaSAic3xeI1woc2V0X3ZhciBFQVNZUlNBX1JFUV9DT1VOVFJZXCkuKnxcMSBcIiR7T1BFTlZQTl9FQVNZUlNBX1JFUV9DT1VOVFJZfVwifGciICRWQVJTCiAgICAgICBzZWQgLWkgInN8XiNcKHNldF92YXIgRUFTWVJTQV9SRVFfUFJPVklOQ0VcKS4qfFwxIFwiJHtPUEVOVlBOX0VBU1lSU0FfUkVRX1BST1ZJTkNFfVwifGciICRWQVJTCiAgICAgICBzZWQgLWkgInN8XiNcKHNldF92YXIgRUFTWVJTQV9SRVFfQ0lUWVwpLip8XDEgXCIke09QRU5WUE5fRUFTWVJTQV9SRVFfQ0lUWX1cInxnIiAkVkFSUwogICAgICAgc2VkIC1pICJzfF4jXChzZXRfdmFyIEVBU1lSU0FfUkVRX09SR1wpLip8XDEgXCIke09QRU5WUE5fRUFTWVJTQV9SRVFfT1JHfVwifGciICRWQVJTCiAgICAgICBzZWQgLWkgInN8XiNcKHNldF92YXIgRUFTWVJTQV9SRVFfRU1BSUxcKS4qfFwxIFwiJHtPUEVOVlBOX0VBU1lSU0FfUkVRX0VNQUlMfVwifGciICRWQVJTCiAgICAgICBzZWQgLWkgInN8XiNcKHNldF92YXIgRUFTWVJTQV9SRVFfT1VcKS4qfFwxIFwiJHtPUEVOVlBOX0VBU1lSU0FfUkVRX09VfVwifGciICRWQVJTCiAgICAgICBzZWQgLWkgInN8XiNcKHNldF92YXIgRUFTWVJTQV9LRVlfU0laRVwpLip8XDEgXCIke09QRU5WUE5fRUFTWVJTQV9LRVlfU0laRX1cInxnIiAkVkFSUwogICAgICAgc2VkIC1pICJzfF4jXChzZXRfdmFyIEVBU1lSU0FfU1NMX0NPTkZcKS4qfFwxIFwiJHtPUEVOVlBOX0VBU1lSU0FfU1NMX0NPTkZ9XCJ8ZyIgJFZBUlMKICAgICAgIHNlZCAtaSAic3xeI1woc2V0X3ZhciBFQVNZUlNBX0JBVENIXCkuKnxcMSBcIiR7T1BFTlZQTl9FQVNZUlNBX0JBVENIfVwifGciICRWQVJTCiAgICAgICBzZWQgLWkgInN8XiNcKHNldF92YXIgRUFTWVJTQV9SRVFfQ05cKS4qfFwxIFwiJHtPUEVOVlBOX0VBU1lSU0FfUkVRX0NOfVwifGciICRWQVJTCiAgICAgICBpbml0aWF0ZV9wa2lfY2FfZGgKICAgIGVsc2UKICAgICAgIGNkICRFQVNZUlNBRElSCiAgICAgICBFQVNZUlNBPSQoZmluZCAuIC1uYW1lICJlYXN5cnNhIikKICAgIGZpCgp9CgoKZ2VuX2NzcigpCnsKICAgaWYgWyAiJE9QRU5WUE5NT0RFIiA9ICJTRVJWRVIiIF0KICAgdGhlbgogICAgICBkaXNwbGF5X291dHB1dCAiJHtCTFVFRk9OVH1SdW5uaW5nIG9uIG9wZW52cG4gc2VydmVyIC4uIgogICAgICBleHBvcnQgU0VSVkVSTkFNRT0iJChob3N0bmFtZSAtcykiCiAgICAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9yZXFzLyR7U0VSVkVSTkFNRX0ucmVxIF1dICYmIHJtIC1mICRFQVNZUlNBRElSL3BraS9yZXFzLyR7U0VSVkVSTkFNRX0ucmVxCiAgICAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9wcml2YXRlLyR7U0VSVkVSTkFNRX0ua2V5IF1dICYmIHJtIC1mICRFQVNZUlNBRElSL3BraS9wcml2YXRlLyR7U0VSVkVSTkFNRX0ua2V5CiAgICAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJHtTRVJWRVJOQU1FfS5jcnQgXV0gJiYgcm0gLWYgJEVBU1lSU0FESVIvcGtpL2lzc3VlZC8ke1NFUlZFUk5BTUV9LmNydAogICAgICBbWyAtZiAkRUFTWVJTQURJUi9wa2kvcmVxcy8ke0NMSUVOVE9SU0VSVkVSfS5yZXEgXV0gJiYgcm0gLWYgJEVBU1lSU0FESVIvcGtpL3JlcXMvJHtDTElFTlRPUlNFUlZFUn0ucmVxCiAgICAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9wcml2YXRlLyR7Q0xJRU5UT1JTRVJWRVJ9LmtleSBdXSAmJiBybSAtZiAkRUFTWVJTQURJUi9wa2kvcHJpdmF0ZS8ke0NMSUVOVE9SU0VSVkVSfS5rZXkKICAgICAgW1sgLWYgJEVBU1lSU0FESVIvcGtpL2lzc3VlZC8ke0NMSUVOVE9SU0VSVkVSfS5jcnQgXV0gJiYgcm0gLWYgJEVBU1lSU0FESVIvcGtpL2lzc3VlZC8ke0NMSUVOVE9SU0VSVkVSfS5jcnQKICAgICAgY2QgJEVBU1lSU0FESVIKICAgICAgZXhwb3J0IEVBU1lSU0FfUkVRX0NOPSIkU0VSVkVSTkFNRSIKICAgICAgZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9R2VuZXJhdGluZyBjZXJ0aWZpY2F0ZSBzaWduaW5nIHJlcXVlc3QgZm9yICRFQVNZUlNBX1JFUV9DTiAuLiIKICAgICAgJEVBU1lSU0EgZ2VuLXJlcSAiJFNFUlZFUk5BTUUiIG5vcGFzcyAKICAgICAgZXhwb3J0IEVBU1lSU0FfUkVRX0NOPSIkQ0xJRU5UT1JTRVJWRVIiCiAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfUdlbmVyYXRpbmcgY2VydGlmaWNhdGUgc2lnbmluZyByZXF1ZXN0IGZvciAkRUFTWVJTQV9SRVFfQ04gLi4iCiAgICAgICRFQVNZUlNBIGdlbi1yZXEgIiRDTElFTlRPUlNFUlZFUiIgbm9wYXNzIAogICAgICB1bnNldCBFQVNZUlNBX1JFUV9DTgogICAgICBjZCAkQ1VSUkRJUgogICBmaQp9CgoKc2lnbl9jZXJ0KCkKewogICBpZiBbICIkT1BFTlZQTk1PREUiID0gIlNFUlZFUiIgXQogICB0aGVuCiAgICAgIGV4cG9ydCBTRVJWRVJOQU1FPSIkKGhvc3RuYW1lIC1zKSIKICAgICAgW1sgLWYgJEVBU1lSU0FESVIvcGtpL2lzc3VlZC8ke1NFUlZFUk5BTUV9LmNydCBdXSAmJiBybSAtZiAkRUFTWVJTQURJUi9wa2kvaXNzdWVkLyR7U0VSVkVSTkFNRX0uY3J0CiAgICAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJHtDTElFTlRPUlNFUlZFUn0uY3J0IF1dICYmIHJtIC1mICRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJHtDTElFTlRPUlNFUlZFUn0uY3J0CiAgICAgIGNkICRFQVNZUlNBRElSCiAgICAgIGV4cG9ydCBFQVNZUlNBX1BBU1NJTj0icGFzczoke09QRU5WUE5fQ0FfUEFTU1dPUkR9IgogICAgICBleHBvcnQgRUFTWVJTQV9SRVFfQ049IiRTRVJWRVJOQU1FIgogICAgICAkRUFTWVJTQSBzaWduLXJlcSAkb3BlbnZwbm1vZGUgJFNFUlZFUk5BTUUKICAgICAgZXhwb3J0IEVBU1lSU0FfUkVRX0NOPSIkQ0xJRU5UT1JTRVJWRVIiCiAgICAgICRFQVNZUlNBIHNpZ24tcmVxIGNsaWVudCAkQ0xJRU5UT1JTRVJWRVIKICAgICAgdW5zZXQgRUFTWVJTQV9SRVFfQ04KICAgICAgdW5zZXQgRUFTWVJTQV9QQVNTSU4KICAgICAgY2QgJENVUlJESVIKICAgZWxzZQogICAgICBkaXNwbGF5X291dHB1dCAiJHtCTFVFRk9OVH1SdW5uaW5nIG9uIG9wZW52cG4gY2xpZW50IC4uIgogICAgICBpZiBbWyAhIC1mICRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJChob3N0bmFtZSAtcykuY3J0IHx8ICEgLWYgJEVBU1lSU0FESVIvcGtpL3ByaXZhdGUvJChob3N0bmFtZSAtcykua2V5IHx8ICEgLWYgJEVBU1lSU0FESVIvcGtpL2NhLmNydCB8fCAhIC1mICRFQVNZUlNBRElSL3BraS9wcml2YXRlL2NhLmtleSBdXQogICAgICB0aGVuCiAgICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke1lFTExPRk9OVH1HZW5lcmF0aW5nIENlcnRpZmljYXRlIHNpZ25pbmcgcmVxdWVzdCAoQ1NSKSBhbmQgc2lnbmluZyB0aGUgY2VydGlmaWNhdGUgbXVzdCBiZSBydW4gb24gdGhlIG9wZW52cG4gU2VydmVyISEiCiAgICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfU9uY2UgdGhlIGFib3ZlIHByb2Nlc3MgaXMgcnVuLCB0aGVuIHBsZWFzZSBjb3B5ICRFQVNZUlNBRElSL3BraS9jYS5jcnQsICRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJChob3N0bmFtZSAtcykuY3J0IGFuZCAkRUFTWVJTQURJUi9wa2kvcHJpdmF0ZS8kKGhvc3RuYW1lIC1zKS5rZXkgaW50byB0aGlzIGhvc3QiCiAgICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfVBsZWFzZSBjb3B5IGNsaWVudCBjZXJ0aWZpY2F0ZSBmcm9tIG9wZW52cG4gc2VydmVyIGludG8gdGhlIGNsaWVudCB3aGljaCBtYXkgYmUgc3RvcmVkIHVuZGVyICRFQVNZUlNBRElSIgogICAgICAgICBleGl0CiAgICAgIGZpCiAgIGZpCn0KCmNyZWF0ZV9kZWZhdWx0X3BhcmFtZXRlcnMoKQp7CgoKZWNobyAiJHtPUEVOVlBOX0NBX1BBU1NXT1JEfSIgPiAgL2V0Yy9vcGVudnBuL3Bhc3MudHh0CmNobW9kIGdvLXJ3eCAvZXRjL29wZW52cG4vcGFzcy50eHQKCgppZiBbICIkT1BFTlZQTk1PREUiID0gIlNFUlZFUiIgXQp0aGVuCiAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUV9Q2hlY2tpbmcgQ0EgY2VydGlmaWNhdGUuLi4iCiAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9jYS5jcnQgXV0gJiYgZXhwb3J0IENBQ0VSVD0kRUFTWVJTQURJUi9wa2kvY2EuY3J0CiAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUV9Q2hlY2tpbmcgREguLi4iCiAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9kaC5wZW0gXV0gJiYgZXhwb3J0IERIQ0VSVD0kRUFTWVJTQURJUi9wa2kvZGgucGVtCiAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJHtTRVJWRVJOQU1FfS5jcnQgXV0gJiYgQ0VSVD0kRUFTWVJTQURJUi9wa2kvaXNzdWVkLyR7U0VSVkVSTkFNRX0uY3J0CiAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9wcml2YXRlLyR7U0VSVkVSTkFNRX0ua2V5IF1dICYmIEtFWT0kRUFTWVJTQURJUi9wa2kvcHJpdmF0ZS8ke1NFUlZFUk5BTUV9LmtleQoKICAgZWNobyAtZSAiJE9QRU5WUE5fQ0xJRU5UQ09ORklHX0NNRCIgPiAkT1BFTlZQTl9DTElFTlRDT05GSUdfRElSLyR7Q0xJRU5UT1JTRVJWRVJ9CiAgIGdldF9pcF9hZGRyCgplY2hvICIKbW9kZSBzZXJ2ZXIKdGxzLXNlcnZlcgoKIyBMb2NhbCBhZGRyZXNzIHRvIGxpc3RlbiBvbi4gaS5lLiB0aGUgT3BlblZQTiBzZXJ2ZXIncyBMQU4gYWRkcmVzcwpsb2NhbCAkSVBBRERSCgojIFRoZSBkZWZhdWx0IE9wZW5WUE4gcG9ydApwb3J0ICRPUEVOVlBOX1BPUlQKCiMgUHJvdG9jb2wgdXNlZCB0byB0cmFuc21pdCBiZXR3ZWVuIE9wZW5WUE4gbm9kZXMKcHJvdG8gJE9QRU5WUE5fUFJPVE9DT0wKCiMgSW50ZXJmYWNlIGZvciB0aGUgT3BldlZQTiB0dW5uZWwKZGV2ICRPUEVOVlBOX0RFVgoKIyBDZXJ0aWZpY2F0ZXMKY2VydCAkQ0VSVAprZXkgJEtFWQpjYSAkQ0FDRVJUCmRoICRESENFUlQKYXNrcGFzcyAvZXRjL29wZW52cG4vcGFzcy50eHQKCiMgVGhlIHNlcnZlciBkaXJlY3RpdmUgaW5zdHJ1Y3RzIHRoaXMgT3BlblZQTiBpbnN0YW5jZSB0byBhY3QgYXMgdGhlIGNlbnRyYWwgbm9kZS4KIyBUaGUgbmV0d29yayBJUCBhZGRyZXNzIGFuZCBuZXRtYXNrIGFyZSB1c2VkIGZvciB0aGUgcG9pbnQtdG8tcG9pbnQgY29ubmVjdGlvbnMKIyBiZXR3ZWVuIHRoZSBPcGVuVlBOIHNlcnZlciBhbmQgdGhlIGNsaWVudCBub2Rlcy4gT25seSB0aGUgc2VydmVyIGFuZCB0aGUgY2xpZW50CiMgbmVlZCB0byBrbm93IGFib3V0IHRoaXMgc3VibmV0LgokT1BFTlZQTl9TRVJWRVJfQ01ECiRPUEVOVlBOX1JPVVRFX0NNRAokT1BFTlZQTl9QVVNIX0NNRAojcHVzaCAiZGhjcC1vcHRpb24gRE5TIDguOC44LjgiCiNwdXNoICJyZWRpcmVjdC1nYXRld2F5IGRlZjEiCgojIENyZWF0ZSBhIGZpbGUgZm9yIHBlcnNpc3RlbnQgSVAgYWRkcmVzc2VzLiBIZWxwZnVsIGZvciBpbnRlcm1pdHRlbnQgY29ubmVjdGlvbnMuCiNpZmNvbmZpZy1wb29sLXBlcnNpc3QgL2V0Yy9vcGVudnBuL2lwcC50eHQKCgojIFNwZWNpZmljIGNsaWVudCBjb25maWd1cmF0aW9ucwpjbGllbnQtY29uZmlnLWRpciAkT1BFTlZQTl9DTElFTlRDT05GSUdfRElSCgojIFBlcmlvZGljYWxseSBjaGVjayBjb25uZWN0aXZpdHkgdGhyb3VnaCB0aGUgdHVubmVsIGFuZCByZXN0YXJ0IGlmIGNvbm5lY3Rpdml0eQojIGlzIGxvc3QKa2VlcGFsaXZlIDEwIDEyMApjaXBoZXIgJE9QRU5WUE5fQ0lQSEVSCnRscy12ZXJzaW9uLW1pbiAkT1BFTlZQTl9UTFNWRVJfTUlOCnRscy1jaXBoZXIgJE9QRU5WUE5fVExTX0NJUEhFUgptYXgtY2xpZW50cyAkT1BFTlZQTl9NQVhfQ0xJRU5UUwoKIyBEb3duZ3JhZGUgdG8gYW4gdW5wcml2aWxlZGdlZCB1c2VyIGZvciBzZWN1cml0eSBhZnRlciBpbml0aWFsaXphdGlvbgp1c2VyICRPUEVOVlBOX1VTRVIKZ3JvdXAgJE9QRU5WUE5fR1JPVVAKCiMgVXNlIGEgcGVyc2lzdGVudCBrZXkgYW5kIHR1bm5lbCBpbnRlcmZhY2UuIEhlbHBmdWwgaWYgcnVubmluZyBhcyBhbgojIHVucHJpdmlsZWRnZWQgdXNlciBhbmQgdGhlIGNvbm5lY3Rpb24gZ29lcyBkb3duLgpwZXJzaXN0LWtleQpwZXJzaXN0LXR1bgoKIyBMb2cgbG9jYXRpb24gYW5kIHZlcmJvc2l0eSBsZXZlbApzdGF0dXMgJE9QRU5WUE5fU1RBVFVTX0xPRwp2ZXJiICRPUEVOVlBOX1NUQVRVU19WRVJCT1NJVFkgIiA+ICRDT05GSUdGSUxFCgplbHNlCiAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUV9Q2hlY2tpbmcgQ0EgY2VydGlmaWNhdGUuLi4iCiAgIFtbIC1mICRFQVNZUlNBRElSL3BraS9jYS5jcnQgXV0gJiYgZXhwb3J0IENBQ0VSVD0kRUFTWVJTQURJUi9wa2kvY2EuY3J0CgogICBbWyAtZiAkRUFTWVJTQURJUi9wa2kvaXNzdWVkLyQoaG9zdG5hbWUgLXMpLmNydCBdXSAmJiBDRVJUPSRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJChob3N0bmFtZSAtcykuY3J0IHx8IGRpc3BsYXlfb3V0cHV0ICIke1JFRH1TaWduZWQgY2VydGlmaWNhdGUgJEVBU1lSU0FESVIvcGtpL2lzc3VlZC8kKGhvc3RuYW1lIC1zKS5jcnQgYW5kICRFQVNZUlNBRElSL3BraS9jYS5jcnQgbmVlZCB0byBjb3BpZWQgZnJvbSBvcGVudnBuIHNlcnZlciIKICAgW1sgLWYgJEVBU1lSU0FESVIvcGtpL3ByaXZhdGUvJChob3N0bmFtZSAtcykua2V5IF1dICYmIEtFWT0kRUFTWVJTQURJUi9wa2kvcHJpdmF0ZS8kKGhvc3RuYW1lIC1zKS5rZXkgfHwgZGlzcGxheV9vdXRwdXQgIiR7UkVEfUtleSAkRUFTWVJTQURJUi9wa2kvcHJpdmF0ZS8kKGhvc3RuYW1lIC1zKS5rZXkgbmVlZCB0byBjb3BpZWQgZnJvbSBvcGVudnBuIHNlcnZlciIKCmVjaG8gIgpjbGllbnQKCiMgVGhlIGRlZmF1bHQgT3BlblZQTiBwb3J0CnBvcnQgJE9QRU5WUE5fUE9SVAoKIyBQcm90b2NvbCB1c2VkIHRvIHRyYW5zbWl0IGJldHdlZW4gT3BlblZQTiBub2Rlcwpwcm90byAkT1BFTlZQTl9QUk9UT0NPTAoKIyBJbnRlcmZhY2UgZm9yIHRoZSBPcGV2VlBOIHR1bm5lbApkZXYgJE9QRU5WUE5fREVWCgojIENlcnRpZmljYXRlcwpjZXJ0ICRDRVJUCmtleSAkS0VZCmNhICRDQUNFUlQKYXNrcGFzcyAvZXRjL29wZW52cG4vcGFzcy50eHQKCiMgVGhlIHNlcnZlciBkaXJlY3RpdmUgaW5zdHJ1Y3RzIHRoaXMgT3BlblZQTiBpbnN0YW5jZSB0byBhY3QgYXMgdGhlIGNlbnRyYWwgbm9kZS4KIyBUaGUgbmV0d29yayBJUCBhZGRyZXNzIGFuZCBuZXRtYXNrIGFyZSB1c2VkIGZvciB0aGUgcG9pbnQtdG8tcG9pbnQgY29ubmVjdGlvbnMKIyBiZXR3ZWVuIHRoZSBPcGVuVlBOIHNlcnZlciBhbmQgdGhlIGNsaWVudCBub2Rlcy4gT25seSB0aGUgc2VydmVyIGFuZCB0aGUgY2xpZW50CiMgbmVlZCB0byBrbm93IGFib3V0IHRoaXMgc3VibmV0LgpyZW1vdGUgJEZRRE5DTElFTlRPUlNFUlZFUiAkT1BFTlZQTl9QT1JUCgojIFBlcmlvZGljYWxseSBjaGVjayBjb25uZWN0aXZpdHkgdGhyb3VnaCB0aGUgdHVubmVsIGFuZCByZXN0YXJ0IGlmIGNvbm5lY3Rpdml0eQojIGlzIGxvc3QKa2VlcGFsaXZlIDEwIDEyMApjaXBoZXIgJE9QRU5WUE5fQ0lQSEVSCnRscy12ZXJzaW9uLW1pbiAkT1BFTlZQTl9UTFNWRVJfTUlOCnRscy1jaXBoZXIgJE9QRU5WUE5fVExTX0NJUEhFUiAKbWF4LWNsaWVudHMgJE9QRU5WUE5fTUFYX0NMSUVOVFMKCiMgRG93bmdyYWRlIHRvIGFuIHVucHJpdmlsZWRnZWQgdXNlciBmb3Igc2VjdXJpdHkgYWZ0ZXIgaW5pdGlhbGl6YXRpb24KdXNlciAkT1BFTlZQTl9VU0VSCmdyb3VwICRPUEVOVlBOX0dST1VQCgojIFVzZSBhIHBlcnNpc3RlbnQga2V5IGFuZCB0dW5uZWwgaW50ZXJmYWNlLiBIZWxwZnVsIGlmIHJ1bm5pbmcgYXMgYW4KIyB1bnByaXZpbGVkZ2VkIHVzZXIgYW5kIHRoZSBjb25uZWN0aW9uIGdvZXMgZG93bi4Kbm9iaW5kCnBlcnNpc3Qta2V5CnBlcnNpc3QtdHVuCgojIExvZyBsb2NhdGlvbiBhbmQgdmVyYm9zaXR5IGxldmVsCnN0YXR1cyAkT1BFTlZQTl9TVEFUVVNfTE9HCnZlcmIgJE9QRU5WUE5fU1RBVFVTX1ZFUkJPU0lUWQoKIiA+ICRDT05GSUdGSUxFCgpmaQoKaWYgWyAkPyAtbmUgMCBdCnRoZW4KICAgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1GYWlsZWQgdG8gY3JlYXRlIGRlZmF1bHQgcGFyYW1ldGVycy4uLiIKZWxzZQogICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9Q3JlYXRpbmcgZGVmYXVsdCBwYXJhbWV0ZXJzIGhhcyBiZWVuIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkiCmZpCiAgIAoKfQoKI01haW4KCkNVUlJESVI9JChwd2QpCgoKaWYgW1sgIiRPUEVOVlBOTU9ERSIgIT0gIlNFUlZFUiIgJiYgIiRPUEVOVlBOTU9ERSIgIT0gIkNMSUVOVCIgXV0KdGhlbgogICB1c2FnZQogICBleGl0IDEKZmkKICAgCgppZiBbIC1mIC8uZG9ja2VyZW52IF0KdGhlbgogICBkaXNwbGF5X291dHB1dCAiJHtCTFVFRk9OVH1SdW5uaW5nIG9uIGRvY2tlciBjb250YWluZXIsIHRoZXJlZm9yZSBpdCBtdXN0IHVzZSBob3N0IG5ldHdvcmsuLiIKICAgZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9Q2hlY2tpbmcgd2hldGhlciBpdCBpcyB1c2luZyBob3N0IG5ldHdvcmsuLi4iCiAgIGNoZWNrX25ldHdvcmtfaG9zdAogICBkaXNwbGF5X291dHB1dCAiJHtCTFVFRk9OVH1DaGVja2luZyB3aGV0aGVyIGRldmljZSAkT1BFTlZQTl9ERVYgaXMgYXZhaWxhYmxlLi4uIgogICBpZiBbICIkKGxzIC0xYWQgL2Rldi9uZXQvJE9QRU5WUE5fREVWIHwgd2MgLWwpIiAtZXEgMCBdCiAgIHRoZW4KICAgICAgcnVubmluZ19vbl9kb2NrZXIKICAgICAgZXhpdCAxCiAgIGZpCmZpCmlzX29wZW52cG5fcnVubmluZwpbWyAkPyAtZXEgMCBdXSAmJiBraWxsIC05ICRQSUQKCmlmIFsgIiQoY2hlY2tfZmlsZXN5c3RlbSAkT1ZQTlBFUlNJU1RESVIpIiA9ICJvdmVybGF5IiBdCnRoZW4KICAgIGRpc3BsYXlfb3V0cHV0ICIke1JFRH1EaXJlY3RvcnkgJE9WUE5QRVJTSVNURElSIG11c3QgYmUgbWFwcGVkIHRvIHBlcnNpc3RlbnQgdm9sdW1lISEiCiAgICBleGl0CmZpCgppZiBbICIkT1BFTlZQTk1PREUiID0gIlNFUlZFUiIgXQp0aGVuCiAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfUNyZWF0aW5nIGNlcnRpZmljYXRlLi4uLiIKICAgY3JlYXRlX2NlcnRpZmljYXRlCiAgIFtbICEgLWQgJE9QRU5WUE5fQ0xJRU5UQ09ORklHX0RJUiBdXSAmJiBta2RpciAtcCAkT1BFTlZQTl9DTElFTlRDT05GSUdfRElSCmVsc2UKICAgY3JlYXRlX3RydXN0ZWRfbG9naW4KICAgZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9Q2hlY2tpbmcgdGhlIG9wZW52cG4gZGlzayBvbiBhIHNlcnZlciAkRlFETkNMSUVOVE9SU0VSVkVSIGhvc3QuLi4iCiAgIFtbICEgLWQgJEVBU1lSU0FESVIvcGtpIF1dICYmIG1rZGlyIC1wICRFQVNZUlNBRElSL3BraQogICBbWyAhIC1kICRFQVNZUlNBRElSL3BraS9pc3N1ZWQgXV0gJiYgbWtkaXIgLXAgJEVBU1lSU0FESVIvcGtpL2lzc3VlZAogICBbWyAhIC1kICRFQVNZUlNBRElSL3BraS9wcml2YXRlIF1dICYmIG1rZGlyIC1wICRFQVNZUlNBRElSL3BraS9wcml2YXRlCiAgIHNzaCAgcm9vdEAke0ZRRE5DTElFTlRPUlNFUlZFUn0gImxzIC0xICRFQVNZUlNBRElSL3BraS9jYS5jcnQgMj4vZGV2L251bGwgMT4vZGV2L251bGwiCiAgIGlmIFsgJD8gLW5lIDAgXQogICB0aGVuCiAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfVRyZWF0aW5nIG9wZW52cG4gc2VydmVyIHJ1bm5pbmcgYXMgYSBjb250YWluZXIgd2l0aCBtYXBwZWQgdG8gaG9zdCBkaXNrIGxvY2F0ZWQgdW5kZXIgJE9QRU5WUE5fSE9TVF9ESVNLICIKICAgICAgUk1URUFTWVJTQURJUj0ke09QRU5WUE5fSE9TVF9ESVNLfS9lYXN5LXJzYQogICAgICBzc2ggIHJvb3RAJHtGUUROQ0xJRU5UT1JTRVJWRVJ9ICJscyAtMSAkUk1URUFTWVJTQURJUi9wa2kvY2EuY3J0IDI+L2Rldi9udWxsIDE+L2Rldi9udWxsIgogICAgICBbWyAkPyAtbmUgMCBdICYmIGRpc3BsYXlfb3V0cHV0ICIke1JFREZPTlR9UGxlYXNlIGNoZWNrIG9wZW52cG4gc2VydmVyIGFuZCBpdHMgcGVyc2lzdGVudCBkaXNrLi4iICYmIGV4aXQgMQogICAgICBzY3Agcm9vdEAke0ZRRE5DTElFTlRPUlNFUlZFUn06JFJNVEVBU1lSU0FESVIvcGtpL2NhLmNydCAkRUFTWVJTQURJUi9wa2kKICAgICAgc2NwIHJvb3RAJHtGUUROQ0xJRU5UT1JTRVJWRVJ9OiRSTVRFQVNZUlNBRElSL3BraS9pc3N1ZWQvJChob3N0bmFtZSAtcykuY3J0ICRFQVNZUlNBRElSL3BraS9pc3N1ZWQKICAgICAgc2NwIHJvb3RAJHtGUUROQ0xJRU5UT1JTRVJWRVJ9OiRSTVRFQVNZUlNBRElSL3BraS9wcml2YXRlLyQoaG9zdG5hbWUgLXMpLmtleSAkRUFTWVJTQURJUi9wa2kvcHJpdmF0ZQogICAgICBzY3Agcm9vdEAke0ZRRE5DTElFTlRPUlNFUlZFUn06JFJNVEVBU1lSU0FESVIvcGtpL3ByaXZhdGUvY2Eua2V5ICRFQVNZUlNBRElSL3BraS9wcml2YXRlCiAgIGVsc2UKICAgICAgc2NwIHJvb3RAJHtGUUROQ0xJRU5UT1JTRVJWRVJ9OiRFQVNZUlNBRElSL3BraS9jYS5jcnQgJEVBU1lSU0FESVIvcGtpCiAgICAgIHNjcCByb290QCR7RlFETkNMSUVOVE9SU0VSVkVSfTokRUFTWVJTQURJUi9wa2kvaXNzdWVkLyQoaG9zdG5hbWUgLXMpLmNydCAkRUFTWVJTQURJUi9wa2kvaXNzdWVkCiAgICAgIHNjcCByb290QCR7RlFETkNMSUVOVE9SU0VSVkVSfTokRUFTWVJTQURJUi9wa2kvcHJpdmF0ZS8kKGhvc3RuYW1lIC1zKS5rZXkgJEVBU1lSU0FESVIvcGtpL3ByaXZhdGUKICAgICAgc2NwIHJvb3RAJHtGUUROQ0xJRU5UT1JTRVJWRVJ9OiRFQVNZUlNBRElSL3BraS9wcml2YXRlL2NhLmtleSAkRUFTWVJTQURJUi9wa2kvcHJpdmF0ZQogICBmaQpmaQoKaWYgWyAiJE9QRU5WUE5fUkVCVUlMRF9DRVJUIiA9ICJ5ZXMiIF0KdGhlbgogICBnZW5fY3NyCiAgIHNpZ25fY2VydApmaQoKZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9Q3JlYXRpbmcgZGVmYXVsdCBwYXJhbWV0ZXJzLi4uIgpjcmVhdGVfZGVmYXVsdF9wYXJhbWV0ZXJzCgoKZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9TWFzcXVlcmFkZSBldGhlcm5ldCBhbmQgdHVubmVsIGludGVyZmFjZXMuLi4iCm1hc3F1ZXJhZGVfYWxsCmRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfVJ1bm5pbmcgb3BlbnZwbiAkT1BFTlZQTk1PREUuLi4iCm9wZW52cG4gLS1jb25maWcgL2V0Yy9vcGVudnBuL29wZW52cG4uY29uZgo=" | base64 -d > /usr/local/bin/entrypoint-openvpn.sh
RUN chmod ugo+x /usr/local/bin/entrypoint-openvpn.sh
ENTRYPOINT ["/usr/local/bin/entrypoint-openvpn.sh"]
